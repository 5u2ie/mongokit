<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using relational &mdash; MongoKit v0.4 documentation</title>
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="MongoKit v0.4 documentation" href="index.html" />
    <link rel="next" title="Pylons integration support" href="pylons_support.html" />
    <link rel="prev" title="Delete Cascade" href="cascade.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pylons_support.html" title="Pylons integration support"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cascade.html" title="Delete Cascade"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MongoKit v0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Using relational</a><ul>
<li><a class="reference external" href="#a-simple-example">A simple example</a></li>
<li><a class="reference external" href="#passing-extra-query-to-relation">Passing extra query to relation</a></li>
<li><a class="reference external" href="#multiple-relations">Multiple relations</a></li>
<li><a class="reference external" href="#relations-with-autoref-or-how-to-have-full-relationed-api">Relations with autoref (or how to have full relationed api)</a></li>
<li><a class="reference external" href="#create-complexe-relations">Create complexe relations</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="cascade.html"
                                  title="previous chapter">Delete Cascade</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="pylons_support.html"
                                  title="next chapter">Pylons integration support</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="sources/relations.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-relational">
<h1>Using relational<a class="headerlink" href="#using-relational" title="Permalink to this headline">¶</a></h1>
<p>When you describe your MongoDocument, you can add
some information about the relations beetween your
objects. This will let you have a simple api to
query all related objects from document.</p>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s create a blog post object :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">db_name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span>
<span class="gp">... </span>   <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&quot;mongokit&quot;</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;blog_post&quot;</span><span class="p">:{</span>
<span class="gp">... </span>           <span class="s">&quot;blog_id&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>           <span class="s">&quot;content&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>       <span class="p">},</span>
<span class="gp">... </span>   <span class="p">}</span>
</pre></div>
</div>
<p>now, let&#8217;s create the blog object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">db_name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span>
<span class="gp">... </span>   <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&quot;mongokit&quot;</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;blog&quot;</span><span class="p">:{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">}</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">related_to</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>     <span class="s">&#39;blog_posts&#39;</span><span class="p">:{</span><span class="s">&#39;class&#39;</span><span class="p">:</span><span class="n">BlogPost</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">:</span><span class="s">&#39;blog_post.blog_id&#39;</span><span class="p">},</span>
<span class="gp">... </span>   <span class="p">}</span>
</pre></div>
</div>
<p>The <cite>related_to</cite> descriptor will tell MongoKit that we
want to be able to get all blog post from a blog object.
The syntax is :</p>
<blockquote>
<dl class="docutils">
<dt>related_to = {</dt>
<dd><dl class="first last docutils">
<dt>&#8216;name_of_the_relation&#8217;:{</dt>
<dd>&#8216;class&#8217;:RelatedClassObject,
&#8216;target&#8217;: &#8216;field_where_the_id_is&#8217;,</dd>
</dl>
</dd>
</dl>
<p>}</p>
</blockquote>
<p>For instance, let&#8217;s create a blog and some blog post:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;my blog&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;My Blog&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="o">.</span><span class="n">related</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;blog_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;a great blog post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;blog_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;another great blog post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, we want all blog post related to <cite>blog</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_posts</span> <span class="o">=</span> <span class="n">blog</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">blog_posts</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">blog_posts</span><span class="p">)</span>
<span class="go">[{u&#39;blog_post&#39;: {u&#39;content&#39;: u&#39;a great blog post&#39;, u&#39;blog_id&#39;: u&#39;my blog&#39;}, u&#39;_id&#39;: 1}, {u&#39;blog_post&#39;: {u&#39;content&#39;: u&#39;another great blog post&#39;, u&#39;blog_id&#39;: u&#39;my blog&#39;}, u&#39;_id&#39;: 2}]</span>
</pre></div>
</div>
</div>
<div class="section" id="passing-extra-query-to-relation">
<h2>Passing extra query to relation<a class="headerlink" href="#passing-extra-query-to-relation" title="Permalink to this headline">¶</a></h2>
<p>You can filter all the related document by passing a query to the relation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_posts</span> <span class="o">=</span> <span class="n">blog</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">blog_posts</span><span class="p">({</span><span class="s">&#39;blog_post.content&#39;</span><span class="p">:</span><span class="s">&#39;a great blog post&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">blog_posts</span><span class="p">)</span>
<span class="go">[{u&#39;blog_post&#39;: {u&#39;content&#39;: u&#39;a great blog post&#39;, u&#39;blog_id&#39;: u&#39;my blog&#39;}, u&#39;_id&#39;: 1}]</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-relations">
<h2>Multiple relations<a class="headerlink" href="#multiple-relations" title="Permalink to this headline">¶</a></h2>
<p>The <cite>MongoDocument.related</cite> property can handle many relations.</p>
<p>Let&#8217;s create another object related to our <cite>Blog</cite> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
<span class="gp">... </span>    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&#39;mongokit&#39;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;author&#39;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;blog_id&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<p>The <cite>related</cite> property is set at <cite>MongoDocument</cite>&#8216;s <cite>__init__</cite> so
we can update the <cite>Blog.related_to</cite> to handle <cite>Author</cite> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">related_to</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;authors&#39;</span><span class="p">:{</span><span class="s">&#39;class&#39;</span><span class="p">:</span><span class="n">Author</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">:</span><span class="s">&#39;author.blog_id&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>let&#8217;s create another blog:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author1</span> <span class="o">=</span> <span class="n">Author</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author1</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;me&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author1</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;Me&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author1</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">][</span><span class="s">&#39;blog_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">author2</span> <span class="o">=</span> <span class="n">Author</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author2</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;you&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author2</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;You&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author2</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">][</span><span class="s">&#39;blog_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s get our blog (remember, it must get another instaciation to update the
<cite>related_to</cite> property) :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">get_from_id</span><span class="p">(</span><span class="s">&#39;my blog&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>blog</cite> has now two relations attached to the <cite>related</cite> property</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">authors</span> <span class="o">=</span><span class="n">blog</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">authors</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">authors</span><span class="p">)</span>
<span class="go">[{u&#39;_id&#39;: u&#39;me&#39;, u&#39;author&#39;: {u&#39;blog_id&#39;: u&#39;my blog&#39;, u&#39;name&#39;: u&#39;Me&#39;}}, {u&#39;_id&#39;: u&#39;you&#39;, u&#39;author&#39;: {u&#39;blog_id&#39;: u&#39;my blog&#39;, u&#39;name&#39;: u&#39;You&#39;}}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_posts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">blog_posts</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">blog_posts</span><span class="p">)</span>
<span class="go">[{u&#39;blog_post&#39;: {u&#39;content&#39;: u&#39;a great blog post&#39;, u&#39;blog_id&#39;: u&#39;my blog&#39;}, u&#39;_id&#39;: 1}, {u&#39;blog_post&#39;: {u&#39;content&#39;: u&#39;another great blog post&#39;, u&#39;blog_id&#39;: u&#39;my blog&#39;}, u&#39;_id&#39;: 2}]</span>
</pre></div>
</div>
</div>
<div class="section" id="relations-with-autoref-or-how-to-have-full-relationed-api">
<h2>Relations with autoref (or how to have full relationed api)<a class="headerlink" href="#relations-with-autoref-or-how-to-have-full-relationed-api" title="Permalink to this headline">¶</a></h2>
<p>Relations can handle autoref documents. This brings a
full featured relational layer to MongoKit.</p>
<p>let&#8217;s create a <cite>Blog</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span>
<span class="gp">... </span>    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&quot;mongokit&quot;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;blog&quot;</span><span class="p">:{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<p>and a <cite>BlogPost</cite> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span>
<span class="gp">... </span>   <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&quot;mongokit&quot;</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;blog_post&quot;</span><span class="p">:{</span>
<span class="gp">... </span>           <span class="s">&quot;blog&quot;</span><span class="p">:</span><span class="n">Blog</span><span class="p">,</span>
<span class="gp">... </span>           <span class="s">&quot;content&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>       <span class="p">},</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">use_autorefs</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p><cite>BlogPost</cite> is declared after <cite>Blog</cite> so we have to fill related_to after <cite>BlogPost</cite> declaration</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">related_to</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>  <span class="s">&#39;blog_posts&#39;</span><span class="p">:{</span><span class="s">&#39;class&#39;</span><span class="p">:</span><span class="n">BlogPost</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">:</span><span class="s">&#39;blog_post.blog&#39;</span><span class="p">,</span> <span class="s">&#39;autoref&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;my blog&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;My Blog&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span>
</pre></div>
</div>
<p>we pass now the entired blog object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;a great blog post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;blog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blog</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="p">[</span><span class="s">&#39;blog_post&#39;</span><span class="p">][</span><span class="s">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;another great blog post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">blog_post2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Retrive relations is the same:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">blog_posts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">blog</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">blog_posts</span><span class="p">())</span>
<span class="go">[{u&#39;blog_post&#39;: {u&#39;blog&#39;: {u&#39;blog&#39;: {u&#39;title&#39;: None}, u&#39;_id&#39;: u&#39;my blog&#39;, u&#39;title&#39;: u&#39;My Blog&#39;}, u&#39;content&#39;: u&#39;a great blog post&#39;}, u&#39;_id&#39;: 1}, {u&#39;blog_post&#39;: {u&#39;blog&#39;: {u&#39;blog&#39;: {u&#39;title&#39;: None}, u&#39;_id&#39;: u&#39;my blog&#39;, u&#39;title&#39;: u&#39;My Blog&#39;}, u&#39;content&#39;: u&#39;another great blog post&#39;}, u&#39;_id&#39;: 2}]</span>
</pre></div>
</div>
</div>
<div class="section" id="create-complexe-relations">
<h2>Create complexe relations<a class="headerlink" href="#create-complexe-relations" title="Permalink to this headline">¶</a></h2>
<p>Some time, structures is complexe and we need to describes the
relation deeply. lambda is use to do this.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
<span class="gp">... </span>    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&#39;mongokit&#39;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;tags&#39;</span><span class="p">:{</span><span class="nb">unicode</span><span class="p">:</span><span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">MongoDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
<span class="gp">... </span>    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&#39;mongokit&#39;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;tag&#39;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span>    <span class="n">related_to</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;articles&#39;</span><span class="p">:{</span><span class="s">&#39;class&#39;</span><span class="p">:</span><span class="n">Article</span><span class="p">,</span> <span class="s">&#39;target&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:{</span><span class="s">&#39;article.tags.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">:{</span><span class="s">&#39;$gt&#39;</span><span class="p">:</span><span class="mf">1</span><span class="p">}}}}</span>
</pre></div>
</div>
<p>the &#8216;target&#8217; must be a string or a lambda expression. The lambda expression
takes a parameter wich represent the object &#8216;_id&#8217;. In this example, the
results of the lambda expression with the tag &#8216;foo&#8217; will be :</p>
<blockquote>
{&#8216;article.tags.foo&#8217;:{&#8216;$gt&#8217;:1}}</blockquote>
<p>this mean that only articles which have the tag &#8216;foo&#8217; &gt; 1 will be returned.</p>
<p>Now, let&#8217;s create some tags :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;tag&#39;</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;Foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span><span class="p">[</span><span class="s">&#39;tag&#39;</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;Bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bar</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Let&#8217;s associate those tags with articles :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">article1</span> <span class="o">=</span> <span class="n">Article</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article1</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;article1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article1</span><span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;First article&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article1</span><span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">][</span><span class="s">&#39;tags&#39;</span><span class="p">][</span><span class="s">u&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article1</span><span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">][</span><span class="s">&#39;tags&#39;</span><span class="p">][</span><span class="s">u&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">article2</span> <span class="o">=</span> <span class="n">Article</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article2</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;article2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article2</span><span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;Second article&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article2</span><span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">][</span><span class="s">&#39;tags&#39;</span><span class="p">][</span><span class="s">u&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article2</span><span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">][</span><span class="s">&#39;tags&#39;</span><span class="p">][</span><span class="s">u&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>we want all articles which have the tag &#8216;bar&#8217; &gt; 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">articles</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">articles</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">articles</span><span class="p">)</span>
<span class="go">[{u&#39;article&#39;: {u&#39;tags&#39;: {u&#39;foo&#39;: 2, u&#39;bar&#39;: 3}, u&#39;title&#39;: u&#39;First article&#39;}, u&#39;_id&#39;: u&#39;article1&#39;}, {u&#39;article&#39;: {u&#39;tags&#39;: {u&#39;foo&#39;: 0, u&#39;bar&#39;: 2}, u&#39;title&#39;: u&#39;Second article&#39;}, u&#39;_id&#39;: u&#39;article2&#39;}]</span>
</pre></div>
</div>
<p>idem with the tag &#8216;foo&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">articles</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">articles</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">articles</span><span class="p">)</span>
<span class="go">[{u&#39;article&#39;: {u&#39;tags&#39;: {u&#39;foo&#39;: 2, u&#39;bar&#39;: 3}, u&#39;title&#39;: u&#39;First article&#39;}, u&#39;_id&#39;: u&#39;article1&#39;}]</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pylons_support.html" title="Pylons integration support"
             >next</a> |</li>
        <li class="right" >
          <a href="cascade.html" title="Delete Cascade"
             >previous</a> |</li>
        <li><a href="index.html">MongoKit v0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, Namlook.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.3.
    </div>
  </body>
</html>