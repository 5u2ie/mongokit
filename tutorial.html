<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MongoKit Tutorial &mdash; MongoKit v0.5 documentation</title>
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.5',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="MongoKit v0.5 documentation" href="index.html" />
    <link rel="next" title="Polymorphism with MongoKit" href="inheritance.html" />
    <link rel="prev" title="MongoKit" href="introduction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="inheritance.html" title="Polymorphism with MongoKit"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="MongoKit"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MongoKit v0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">MongoKit Tutorial</a><ul>
<li><a class="reference external" href="#simple-example">Simple Example</a></li>
<li><a class="reference external" href="#the-structure">The structure</a><ul>
<li><a class="reference external" href="#validate-keys">validate keys</a></li>
<li><a class="reference external" href="#untyped-field">Untyped field</a></li>
<li><a class="reference external" href="#difference-beetween-and-the-type-list">Difference beetween [] and the type list</a></li>
<li><a class="reference external" href="#difference-beetween-and-the-type-dict">Difference beetween {} and the type dict</a></li>
<li><a class="reference external" href="#case-of-tuple-or-immutable-field">Case of tuple or immutable field</a></li>
<li><a class="reference external" href="#adding-more-authorized-types">Adding more authorized types</a></li>
</ul>
</li>
<li><a class="reference external" href="#descriptors">Descriptors</a><ul>
<li><a class="reference external" href="#required">required</a></li>
<li><a class="reference external" href="#default-values">default_values</a></li>
<li><a class="reference external" href="#validators">validators</a></li>
<li><a class="reference external" href="#i18n">i18n</a></li>
</ul>
</li>
<li><a class="reference external" href="#adding-complex-validation">Adding complex validation</a></li>
<li><a class="reference external" href="#mongokitoperator">MongokitOperator</a><ul>
<li><a class="reference external" href="#or-operator">OR operator</a></li>
<li><a class="reference external" href="#not-operator">NOT operator</a></li>
<li><a class="reference external" href="#is-operator">IS operator</a></li>
</ul>
</li>
<li><a class="reference external" href="#custom-types">Custom types</a></li>
<li><a class="reference external" href="#skipping-validation">Skipping validation</a></li>
<li><a class="reference external" href="#quiet-validation-detection">Quiet validation detection</a></li>
<li><a class="reference external" href="#query">Query</a><ul>
<li><a class="reference external" href="#getting-raw-data">Getting raw data</a><ul>
<li><a class="reference external" href="#find-and-find-one">find() and find_one()</a></li>
<li><a class="reference external" href="#one">one()</a></li>
<li><a class="reference external" href="#find-random">find_random()</a></li>
</ul>
</li>
<li><a class="reference external" href="#getting-document-instance">Getting Document instance</a></li>
<li><a class="reference external" href="#find">find()</a></li>
<li><a class="reference external" href="#find-one">find_one()</a></li>
<li><a class="reference external" href="#id1">one()</a></li>
<li><a class="reference external" href="#fetch">fetch()</a></li>
<li><a class="reference external" href="#fetch-one">fetch_one()</a></li>
<li><a class="reference external" href="#id2">find_random()</a></li>
</ul>
</li>
<li><a class="reference external" href="#updating-data">Updating data</a><ul>
<li><a class="reference external" href="#update-a-document">Update a document</a></li>
<li><a class="reference external" href="#bulk-update">Bulk update</a></li>
<li><a class="reference external" href="#reload">reload()</a></li>
</ul>
</li>
<li><a class="reference external" href="#changing-collection-dynamically">Changing collection dynamically</a></li>
<li><a class="reference external" href="#dot-notation">Dot notation</a></li>
<li><a class="reference external" href="#embedding-documents-as-values">Embedding Documents as values</a><ul>
<li><a class="reference external" href="#a-detailed-example">A detailed example</a><ul>
<li><a class="reference external" href="#about-cross-database-references">About cross-database references</a></li>
<li><a class="reference external" href="#reference-and-dereference">Reference and dereference</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#indexes">Indexes</a></li>
<li><a class="reference external" href="#json-support">JSON support</a><ul>
<li><a class="reference external" href="#objectid-support">ObjectId support</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="introduction.html"
                                  title="previous chapter">MongoKit</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="inheritance.html"
                                  title="next chapter">Polymorphism with MongoKit</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="sources/tutorial.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mongokit-tutorial">
<h1>MongoKit Tutorial<a class="headerlink" href="#mongokit-tutorial" title="Permalink to this headline">¶</a></h1>
<p>First of all, Mongokit relied heavily on pymongo. As such, all pymongo API is
exposed. If you don&#8217;t find what you want in the Mongokit document, please take
a look at <a class="reference external" href="http://api.mongodb.org/python/">pymongo</a> &#8216;s one.  All the pymongo API is exposed via connection,
database and collection so Connection, Database and Collection are wrapper
around pymongo objects.</p>
<div class="section" id="simple-example">
<h2>Simple Example<a class="headerlink" href="#simple-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mongokit</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;body&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;author&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;date_creation&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;rank&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">unicode</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span>    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span><span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="s">&#39;date_creation&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;rank&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;date_creation&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">}</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>The structure is a simply dictionnary with python type. In this example, <cite>title</cite> must be unicode and <cite>rank</cite>
must be an int.</p>
<p>Optionaly, you can add some descriptors. In order to specify fields which are required, just add a <cite>required_fields</cite>
attribute. This is a simple list which list all required_fields (ie, those field must not be None when validating).</p>
<p>Same thing with the <cite>default_values</cite> attribute. This is a dict where you can specify default values. Note that
you can pass callable object (like a datetime).</p>
<p>Now, fire a connection and register the <tt class="docutils literal"><span class="pre">BlogPost</span></tt> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">BlogPost</span><span class="p">])</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">new in version 0.5.12</p>
<p>now the register method can be used as a decorator:</p>
<div class="highlight-python"><pre>@con.register
class BlogPost(Document):
    structure = {...}</pre>
</div>
</div>
<p>Let&#8217;s do some cleanup before continue:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="s">&#39;tutorial&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let&#8217;s create a blogpost we want to work on the collection &#8220;tutorial&#8221; on the database &#8220;test&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">tutorial</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span>
<span class="go">{&#39;body&#39;: None, &#39;title&#39;: None, &#39;date_creation&#39;: datetime.datetime(...), &#39;rank&#39;: 0, &#39;author&#39;: None}</span>
</pre></div>
</div>
<p>Not that <cite>date_creation</cite> was automaticly filled by <cite>utcnow()</cite> and rank is 0.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;my first blog post&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">title must be an instance of unicode not str</span>
</pre></div>
</div>
<p><cite>str</cite> type is not authorized, you must use unicode :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;my first blog post&quot;</span>
</pre></div>
</div>
<p><cite>validate</cite> method will check if required fields are set :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">RequireFieldError</span>: <span class="n-Identifier">author is required</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;myself&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that <cite>save</cite> will call the <cite>validate</cite> method, so you don&#8217;t have to validate
each time.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>You can disable or force the validation with the <cite>validate</cite> argument in the <cite>save</cite> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-structure">
<h2>The structure<a class="headerlink" href="#the-structure" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">structure</span></tt> is a simple dict which define how document fields will be validated.
Field types are simple python type.  By default, MongoKit allow the following types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">authorized_types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span>
  <span class="nb">bool</span><span class="p">,</span>
  <span class="nb">int</span><span class="p">,</span>
  <span class="nb">float</span><span class="p">,</span>
  <span class="nb">long</span><span class="p">,</span>
  <span class="nb">unicode</span><span class="p">,</span>
  <span class="nb">list</span><span class="p">,</span>
  <span class="nb">dict</span><span class="p">,</span>
  <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
  <span class="n">pymongo</span><span class="o">.</span><span class="n">binary</span><span class="o">.</span><span class="n">Binary</span><span class="p">,</span>
  <span class="n">pymongo</span><span class="o">.</span><span class="n">objectid</span><span class="o">.</span><span class="n">ObjectId</span><span class="p">,</span>
  <span class="n">pymongo</span><span class="o">.</span><span class="n">dbref</span><span class="o">.</span><span class="n">DBRef</span><span class="p">,</span>
  <span class="n">pymongo</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">Code</span><span class="p">,</span>
  <span class="nb">type</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)),</span>
  <span class="n">CustomType</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <cite>set()</cite> python type is not supported in pymongo. If you want to use it anyway please use the <cite>Set()</cite> custom type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;tags&quot;</span><span class="p">:</span> <span class="n">Set</span><span class="p">(</span><span class="nb">unicode</span><span class="p">),</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="section" id="validate-keys">
<h3>validate keys<a class="headerlink" href="#validate-keys" title="Permalink to this headline">¶</a></h3>
<p>If the value of key is not known but we want to validate some deeper structure,
we use the &#8220;$&lt;type&gt;&#8221; descriptor :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;key1&quot;</span><span class="p">:{</span>
<span class="gp">... </span>           <span class="nb">unicode</span><span class="p">:{</span>
<span class="gp">... </span>               <span class="s">&quot;bla&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>               <span class="s">&quot;bar&quot;</span><span class="p">:{</span><span class="nb">unicode</span><span class="p">:</span><span class="nb">int</span><span class="p">}</span>
<span class="gp">... </span>           <span class="p">},</span>
<span class="gp">... </span>       <span class="p">},</span>
<span class="gp">... </span>       <span class="s">&quot;bla&quot;</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;key1.$unicode.bla&quot;</span><span class="p">]</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Not that if you use python type as key in structure, generate_skeleton
won&#8217;t be able to build the entired underline structure :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s">&#39;key1&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s">&#39;bla&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
<span class="go">True</span>
</pre></div>
</div>
<p>So, default_values nor validators will work.</p>
</div>
<div class="section" id="untyped-field">
<h3>Untyped field<a class="headerlink" href="#untyped-field" title="Permalink to this headline">¶</a></h3>
<div class="topic">
<p class="topic-title first">new in version 0.5.6</p>
<p>Sometime you don&#8217;t want to specify a type for a field. In order to allow a
field to have any authorized types, just set the field to None into the
structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;foo&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;bar&#39;</span><span class="p">:</span><span class="bp">None</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>In this example, <cite>bar</cite> can be of any authorized types but not CustomTypes.</p>
</div>
</div>
<div class="section" id="difference-beetween-and-the-type-list">
<h3>Difference beetween [] and the type list<a class="headerlink" href="#difference-beetween-and-the-type-list" title="Permalink to this headline">¶</a></h3>
<p>This is pretty simple. if you want to define a list of heterogen types just do:</p>
<blockquote>
tags : list</blockquote>
<p>If you use the type <cite>list</cite>, no validation will be done on this field other than
checking that the field is a list. If you want to define a list of unicode :</p>
<blockquote>
tag : [unicode]</blockquote>
<p>When validating the document, this will iterate to the list and check if all value
are unicode.</p>
</div>
<div class="section" id="difference-beetween-and-the-type-dict">
<h3>Difference beetween {} and the type dict<a class="headerlink" href="#difference-beetween-and-the-type-dict" title="Permalink to this headline">¶</a></h3>
<p>{} is used for describing the structure like {&#8220;foo&#8221;:unicode, &#8220;bar&#8221;:int}</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;biography&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">}</span>
<span class="gp">... </span>   <span class="p">}</span>
</pre></div>
</div>
<p>If you don&#8217;t specify the structure :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;biography&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="gp">... </span>   <span class="p">}</span>
</pre></div>
</div>
<p>You won&#8217;t be able to do that because &#8220;foo&#8221; is not defined into the structure.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">Person</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Person</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span><span class="p">[</span><span class="s">u&quot;biography&quot;</span><span class="p">][</span><span class="s">u&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;bla&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">StructureError: unknown fields </span>: <span class="n-Identifier">[u&#39;foo&#39;]</span>
</pre></div>
</div>
<p>If you want to add new items to a dict if they&#8217;re not defined, you must use the dict type instead :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;biography&quot;</span><span class="p">:</span> <span class="nb">dict</span>
<span class="gp">... </span>   <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">Person</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Person</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span><span class="p">[</span><span class="s">u&quot;biography&quot;</span><span class="p">][</span><span class="s">u&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;bla&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<p>Using dict type is useful if you don&#8217;t know what field will be added <em>and</em> what will be the type of the field.
If you know the type of the field, it&#8217;s better to do that :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;biography&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">unicode</span><span class="p">:</span><span class="nb">unicode</span><span class="p">}</span>
<span class="gp">... </span>   <span class="p">}</span>
</pre></div>
</div>
<p>This will add another layer to validate the content. See &#8220;validate keys&#8221; section for more informations.</p>
</div>
<div class="section" id="case-of-tuple-or-immutable-field">
<h3>Case of tuple or immutable field<a class="headerlink" href="#case-of-tuple-or-immutable-field" title="Permalink to this headline">¶</a></h3>
<p>If you need a structured list with a limited
number of field, you can use tuple to describe
your object :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;foo&quot;</span><span class="p">:(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">[None, None, None]</span>
</pre></div>
</div>
<p>Tuple are converted into a simple list.
They add another validation layer. Field must
follow the right type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot;bla&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">foo must be an instance of int not unicode</span>
</pre></div>
</div>
<p>and they must have the right number of items:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s">u&quot;bla&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">foo must have 3 items not 2</span>
</pre></div>
</div>
<p>As tuples are converted to list internally, you
can make all list operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s">u&#39;bar&#39;</span><span class="p">,</span><span class="mf">3.2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">u&quot;bla&quot;</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-more-authorized-types">
<h3>Adding more authorized types<a class="headerlink" href="#adding-more-authorized-types" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s possible to add more type in authorized_types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span>    <span class="n">authorized_types</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">authorized_types</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bla&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="descriptors">
<h2>Descriptors<a class="headerlink" href="#descriptors" title="Permalink to this headline">¶</a></h2>
<p>In the MongoKit philosophy, the structure must be simple, clear and readable. So all descriptors (like validation, requirement, default values etc...) are describes outside the structure.
Descriptors can be combined and can apply the same field.</p>
<div class="section" id="required">
<h3>required<a class="headerlink" href="#required" title="Permalink to this headline">¶</a></h3>
<p>This descriptor describes the required fiels:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
        <span class="s">&quot;foo&quot;</span><span class="p">:{</span>
            <span class="s">&quot;spam&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
            <span class="s">&quot;eggs&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo.spam&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If you want to reach nested fields, just use the dot notation.</p>
</div>
<div class="section" id="default-values">
<h3>default_values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p>This descriptors allow to specify a default value at the creation of the document:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
     <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
         <span class="s">&quot;foo&quot;</span><span class="p">:{</span>
             <span class="s">&quot;spam&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
             <span class="s">&quot;eggs&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;bar&#39;</span><span class="p">:</span><span class="s">u&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;foo.eggs&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
</pre></div>
</div>
<p>Not that the default value must be a valid type (here unicode)</p>
</div>
<div class="section" id="validators">
<h3>validators<a class="headerlink" href="#validators" title="Permalink to this headline">¶</a></h3>
<p>This descriptor bring a validation layer to a field. It take a function which returns a <cite>False</cite> if the validation fails, <cite>True</cite> otherwise:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="k">def</span> <span class="nf">email_validator</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
   <span class="n">email</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(?:^|\s)[-a-z0-9_.]+@(?:[-a-z0-9]+\.)+[a-z]{2,6}(?:\s|$)&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
   <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">&quot;email&quot;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">,</span>
      <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;eggs&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="n">validators</span> <span class="o">=</span> <span class="p">{</span>
       <span class="s">&quot;email&quot;</span><span class="p">:</span> <span class="n">email_validator</span><span class="p">,</span>
       <span class="s">&quot;foo.eggs&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span>
   <span class="p">}</span>
</pre></div>
</div>
<p>You can add custom message in your validators:</p>
<div class="highlight-python"><pre>def email_validator(value):
   email = re.compile(r"(?:^|\s)[-a-z0-9_.]+@(?:[-a-z0-9]+\.)+[a-z]{2,6}(?:\s|$)",re.IGNORECASE)
   if not bool(email.match(value))
      raise ValidatorError("%s is not a valid email")</pre>
</div>
<p>Note that it is a good thing to add one more &#8220;%s&#8221; in message. This will be use to describes the failing field name.</p>
<p>You can also pass params in your validator. This is how you can dor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MinLengthValidator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span> <span class="o">=</span> <span class="n">min_length</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> must be atleast &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; characters long.&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="nb">unicode</span>
    <span class="p">}</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="n">MinLengthValidator</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>In this example, <cite>first_name</cite> must contain at least 2 characters.</p>
</div>
<div class="section" id="i18n">
<h3>i18n<a class="headerlink" href="#i18n" title="Permalink to this headline">¶</a></h3>
<p>This descriptor will tell MongoKIT that a field has multiple translation. Please see the <a class="reference external" href="i18n.html">i18n section</a> for more details:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
     <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
         <span class="s">&quot;foo&quot;</span><span class="p">:{</span>
             <span class="s">&quot;spam&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
             <span class="s">&quot;eggs&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="n">i18n</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo.eggs&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-complex-validation">
<h2>Adding complex validation<a class="headerlink" href="#adding-complex-validation" title="Permalink to this headline">¶</a></h2>
<p>If the use of a validator is not enougth, you can overload the validation method
to feet your needs.</p>
<p>Example the following document:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>            <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&quot;baz&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>We want to be sure that before saving our object, foo is greater than bar and baz is
unicode(foo). Do do that, we juste overload the validation method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;bar&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;baz&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">])</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">MyDoc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="mongokitoperator">
<h2>MongokitOperator<a class="headerlink" href="#mongokitoperator" title="Permalink to this headline">¶</a></h2>
<p>It is possible to add another layer of validation to fields.</p>
<div class="section" id="or-operator">
<h3>OR operator<a class="headerlink" href="#or-operator" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say that we have a field which can be unicode or int or a float.
We can use the OR operator to tell MongoKit to validate the field :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mongokit</span> <span class="kn">import</span> <span class="n">OR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;balance&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="n">OR</span><span class="p">(</span><span class="nb">unicode</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">Account</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Account</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;3.0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<p>but :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">balance.foo must be an instance of &lt;unicode or int or float&gt; not datetime</span>
</pre></div>
</div>
</div>
<div class="section" id="not-operator">
<h3>NOT operator<a class="headerlink" href="#not-operator" title="Permalink to this headline">¶</a></h3>
<p>You can also use the NOT operator to tell MongoKit that you don&#8217;t want a such type
for a field :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mongokit</span> <span class="kn">import</span> <span class="n">NOT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;balance&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="n">NOT</span><span class="p">(</span><span class="nb">unicode</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">Account</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Account</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<p>and :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">balance.foo must be an instance of &lt;not unicode, not datetime&gt; not datetime</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;balance&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;3.0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">balance.foo must be an instance of &lt;not unicode, not datetime&gt; not unicode</span>
</pre></div>
</div>
</div>
<div class="section" id="is-operator">
<h3>IS operator<a class="headerlink" href="#is-operator" title="Permalink to this headline">¶</a></h3>
<p>Sometime, you might want to force a fields to be in a specifique value. The IS operator
must be use for this purpose :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mongokit</span> <span class="kn">import</span> <span class="n">IS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;flag&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="n">IS</span><span class="p">(</span><span class="s">u&#39;spam&#39;</span><span class="p">,</span> <span class="s">u&#39;controversy&#39;</span><span class="p">,</span> <span class="s">u&#39;phishing&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">Account</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Account</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;spam&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;phishing&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<p>and :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">account</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">flag.foo must be in [u&#39;spam&#39;, u&#39;controversy&#39;, u&#39;phishing&#39;] not foo</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-types">
<h2>Custom types<a class="headerlink" href="#custom-types" title="Permalink to this headline">¶</a></h2>
<p>Sometime, we need to work with complexe object while their
footprint in the database is fairly simple. Let&#8217;s take a
datetime object. Datetime object can be usefull to compute
complexe date but while mongodb can deal with datetime object,
let&#8217;s say that we just want to store the unicode representation.</p>
<p>MongoKit allow the use to work on a datetime object and store the unicode
representation on the fly. In order to do this, we have to implement a CustomType
and fill the custom_types attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
</pre></div>
</div>
<p>A CustomType object must implement two methods and one attribute:</p>
<blockquote>
<ul>
<li><dl class="first docutils">
<dt><cite>to_bson(self, value)</cite>: this method will convert the value</dt>
<dd><p class="first last">to fit the correct authorized type before beeing saved in the db.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>to_python(self, value)</cite>: this method will convert the value</dt>
<dd><p class="first last">taken from the db into a python object</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>validate(self, value, path)</cite>: this method is optionnal and will add a</dt>
<dd><p class="first last">validation layer. Please, see the <cite>Set()</cite> CustomType code for more example.</p>
</dd>
</dl>
</li>
<li><p class="first">You must specify a <cite>mongo_type</cite> property in the <cite>CustomType</cite> class. this
will describes the type of the value stored in the mongodb.</p>
</li>
<li><p class="first">If you want more validation, you can specify a <cite>python_type</cite> property which is
the python type the value will be converted. This is a good thing to specify it
as it make a good documentation.</p>
</li>
<li><p class="first"><cite>init_type</cite> attribute will allow to describes an empty value. For example,
if you implement the python set as CustomType, you&#8217;ll set <cite>init_type</cite> to
<cite>set</cite>. Note that <cite>init_type</cite> must be a type or a callable instance.</p>
</li>
</ul>
</blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomDate</span><span class="p">(</span><span class="n">CustomType</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">mongo_type</span> <span class="o">=</span> <span class="nb">unicode</span>
<span class="gp">... </span>    <span class="n">python_type</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="c"># optional, just for more validation</span>
<span class="gp">... </span>    <span class="n">init_type</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># optional, fill the first empty value</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">to_bson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="sd">&quot;&quot;&quot;convert type to a mongodb type&quot;&quot;&quot;</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="s">&#39;%y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="sd">&quot;&quot;&quot;convert type to a python object&quot;&quot;&quot;</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>           <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;%y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="gp">... </span>        <span class="sd">&quot;&quot;&quot;OPTIONAL : useful to add a validation layer&quot;&quot;&quot;</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">pass</span> <span class="c"># ... do something here</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Now, let&#8217;s create a Document:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;foo&#39;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="n">CustomDate</span><span class="p">(),</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<p>Now, we can create Foo&#8217;s objects and working with python datetime objects</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">Foo</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>The saved object in db has the unicode footprint as expected:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">&#39;_id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="go">{u&#39;_id&#39;: 1, u&#39;foo&#39;: {u&#39;date&#39;: u&#39;03-02-01&#39;}}</span>
</pre></div>
</div>
<p>Quering an object will convert automaticly the CustomType into the correct
python object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Foo</span><span class="o">.</span><span class="n">get_from_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;date&#39;</span><span class="p">]</span>
<span class="go">datetime.datetime(2003, 2, 1, 0, 0)</span>
</pre></div>
</div>
</div>
<div class="section" id="skipping-validation">
<h2>Skipping validation<a class="headerlink" href="#skipping-validation" title="Permalink to this headline">¶</a></h2>
<p>Once your application is ready for production and you are sure that the data is consistant,
you might want to skip the validation layer. This will make mongokit significant faster
(as fast as pymongo). In order to do that, just set the <cite>skip_validation</cite> attribute to <cite>True</cite>.</p>
<p>TIP: this is a good idea to create a &#8220;RootDocument&#8221; and to inherite all you object from it.
This will allow you to control the behavior of all your objects by setting the RootDocument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">RootDocument</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">... </span>    <span class="n">skip_validation</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">... </span>    <span class="n">use_autorefs</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">RootDocument</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>            <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<p>Note that you can always force the validation at any moment on saving even if <cite>skip_validation</cite> is <cite>True</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span> <span class="c"># No need to register RootDocument as we do not instanciate it</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">foo must be an instance of int not unicode</span>
</pre></div>
</div>
</div>
<div class="section" id="quiet-validation-detection">
<h2>Quiet validation detection<a class="headerlink" href="#quiet-validation-detection" title="Permalink to this headline">¶</a></h2>
<div class="topic">
<p class="topic-title first">new in version 0.5.4</p>
<p>By default, when validation is on each error raises an Exception. Sometime, you just want to
collect errors in one place. This is possible by setting the <cite>raise_validation_errors</cite> to False.
At this moment, all errors are store in the <cite>validation_errors</cite> attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">raise_validation_errors</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">... </span>    <span class="n">structure</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">validation_errors</span>
<span class="go">{&#39;foo&#39;: [StructureError(&quot;&lt;type &#39;set&#39;&gt; is not an authorized type&quot;,), RequireFieldError(&#39;foo is required&#39;,)]}</span>
</pre></div>
</div>
<p><cite>validation_errors</cite> is a dictionnary which take the field name as key and the python exception as value.
Here foo has two issues : a structure one (<cite>set</cite> is not an authorized type) and is required.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">validation_errors</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span>
<span class="go">&quot;&lt;type &#39;set&#39;&gt; is not an authorized type&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="query">
<h2>Query<a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h2>
<p>There&#8217;s two ways to query a collection : getting raw data or <tt class="docutils literal"><span class="pre">Document</span></tt> instance.</p>
<div class="section" id="getting-raw-data">
<h3>Getting raw data<a class="headerlink" href="#getting-raw-data" title="Permalink to this headline">¶</a></h3>
<p>Getting raw data is usefull when you only want to have value from your data. This is fast
as there&#8217;s no validation or wrapping. There is two methods to query raw data : <cite>find()</cite> and
<cite>find_one()</cite>, <cite>one()</cite> and <cite>find_random()</cite>.</p>
<div class="section" id="find-and-find-one">
<h4>find() and find_one()<a class="headerlink" href="#find-and-find-one" title="Permalink to this headline">¶</a></h4>
<p><cite>find()</cite>, and <cite>find_one()</cite> act like the similar pymongo&#8217;s methods.
Please, see the pymongo documentation</p>
</div>
<div class="section" id="one">
<h4>one()<a class="headerlink" href="#one" title="Permalink to this headline">¶</a></h4>
<p><cite>one()</cite> act like <cite>find()</cite> but will raise a <cite>mongokit.MultipleResultsFound</cite> exception if
there is more than one result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bp2</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bp2</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;my second blog post&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bp2</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;you&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bp2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">MultipleResultsFound</span>: <span class="n-Identifier">2 results found</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span><span class="o">.</span><span class="n">one</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;my first blog post&#39;</span><span class="p">})</span>
<span class="go">{u&#39;body&#39;: None, u&#39;author&#39;: u&#39;myself&#39;, u&#39;title&#39;: u&#39;my first blog post&#39;, u&#39;rank&#39;: 0, u&#39;_id&#39;: ObjectId(&#39;4b5ec4b690bce73814000000&#39;), u&#39;date_creation&#39;: datetime.datetime(2010, 1, 26, 10, 32, 22, 497000)}</span>
</pre></div>
</div>
<p>If no document is found, <cite>one()</cite> returns <cite>None</cite></p>
</div>
<div class="section" id="find-random">
<h4>find_random()<a class="headerlink" href="#find-random" title="Permalink to this headline">¶</a></h4>
<p><cite>find_random()</cite> will return a random document from the database. This method doesn&#8217;t take other arguments.</p>
</div>
</div>
<div class="section" id="getting-document-instance">
<h3>Getting Document instance<a class="headerlink" href="#getting-document-instance" title="Permalink to this headline">¶</a></h3>
<p>There is 4 methods to query your data and get Document&#8217;s instance :
<cite>find()</cite>, <cite>find_one()</cite>, <cite>fetch()</cite>, <cite>fetch_one</cite> and <cite>find_random()</cite>.
<cite>find()</cite> and <cite>fetch()</cite> return a cursor of collection.  A cursor is a container
which lazy evaluate the results. A cursor is acting like an iterator.
<cite>find_one()</cite> and <cite>fetch_one()</cite> return the document itself.</p>
<p>All theses method can take a query as argument. A query is a simple dict. Please,
see the mongodb and the pymongo documentation for further details.</p>
</div>
<div class="section" id="find">
<h3>find()<a class="headerlink" href="#find" title="Permalink to this headline">¶</a></h3>
<p><cite>find()</cite> without argument will return a cursor of all documents of the collection.
If a query is passed, it will return a cursor all documents which match the query.</p>
<p><cite>find()</cite> takes the same arguments than the the <cite>pymongo.collection.find</cite> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">post</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
<span class="go">my first blog post</span>
<span class="go">my second blog post</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;my first blog post&#39;</span><span class="p">}):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">post</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
<span class="go">my first blog post</span>
</pre></div>
</div>
</div>
<div class="section" id="find-one">
<h3>find_one()<a class="headerlink" href="#find-one" title="Permalink to this headline">¶</a></h3>
<p><cite>find_one()</cite> act like <cite>find()</cite> but return only the first document of result. This
method takes the same arguments than the pymongo&#8217;s <cite>find_one()</cite> method. Please, check
the pymongo&#8217;s documentation.</p>
</div>
<div class="section" id="id1">
<h3>one()<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><cite>one()</cite> act like <cite>find()</cite> but will raise a <cite>mongokit.MultipleResultsFound</cite> exception if
there is more than one result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">MultipleResultsFound</span>: <span class="n-Identifier">2 results found</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">one</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">&#39;my first blog post&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span>
<span class="go">{u&#39;body&#39;: None, u&#39;title&#39;: u&#39;my first blog post&#39;, u&#39;author&#39;: u&#39;myself&#39;, u&#39;rank&#39;: 0, u&#39;_id&#39;: ObjectId(&#39;4b5ec4b690bce73814000000&#39;), u&#39;date_creation&#39;: datetime.datetime(2010, 1, 26, 10, 32, 22, 497000)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">BlogPost</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>If no document is found, <cite>one()</cite> returns None</p>
</div>
<div class="section" id="fetch">
<h3>fetch()<a class="headerlink" href="#fetch" title="Permalink to this headline">¶</a></h3>
<p>Unlike <cite>find()</cite>, <cite>fetch()</cite> will return only documents which match the structure of the Document.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">all_blog_posts</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
</pre></div>
</div>
<p>This will return only all blog post (which have &#8216;title&#8217;, &#8216;body&#8217;, &#8216;author&#8217;, &#8216;date_creation&#8217;, &#8216;rank&#8217; as fields).
This is an helper for :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">all_blog_posts</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">&#39;body&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;date_creation&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;rank&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
</pre></div>
</div>
<p>Note, like <cite>find()</cite> and and <cite>one()</cite>, you can pass advanced queries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_blog_posts</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">fetch</span><span class="p">({</span><span class="s">&#39;author&#39;</span><span class="p">:</span><span class="s">&#39;myself&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>which is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">all_blog_posts</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">&#39;body&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;date_creation&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;rank&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;$exists&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="s">&#39;myself&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="fetch-one">
<h3>fetch_one()<a class="headerlink" href="#fetch-one" title="Permalink to this headline">¶</a></h3>
<p>Juste like <cite>fetch()</cite> but raise a  <cite>mongokit.MultipleResultsFound</cite> exception if
there is more than one result.</p>
</div>
<div class="section" id="id2">
<h3>find_random()<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><cite>find_random()</cite> will return a random document from the database. This method doesn&#8217;t take other arguments.</p>
</div>
</div>
<div class="section" id="updating-data">
<h2>Updating data<a class="headerlink" href="#updating-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="update-a-document">
<h3>Update a document<a class="headerlink" href="#update-a-document" title="Permalink to this headline">¶</a></h3>
<div class="topic">
<p class="topic-title first">new in version 0.5.6</p>
<p>Mongokit now support atomic update out of the box !</p>
<p>Update in Mongokit is as easy than saving an object. Just modify your
document, save it and that&#8217;s it ! Your document is updated using atomic
update. To do that, your document must contain the field <cite>_version</cite>. Here&#8217;s an
complete example of how updating work with Mongokit:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&#39;foo&#39;</span><span class="p">:{</span>
<span class="gp">... </span>           <span class="s">&#39;bar&#39;</span><span class="p">:[</span><span class="nb">unicode</span><span class="p">],</span>
<span class="gp">... </span>           <span class="s">&#39;eggs&#39;</span><span class="p">:{</span><span class="s">&#39;spam&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>       <span class="p">},</span>
<span class="gp">... </span>       <span class="s">&#39;bla&#39;</span><span class="p">:</span><span class="nb">unicode</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">atomic_save</span> <span class="o">=</span> <span class="bp">True</span> <span class="c"># enable atomic saving</span>

<span class="go">NOTE : as atomic saving required to modify documents by adding a new</span>
<span class="go">field (`_version`), you have to explicitly tell mongokit that you wan&#39;t</span>
<span class="go">to use this new feature by setting the attribute `atomic_save` as True.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&#39;mybar&#39;</span><span class="p">,</span> <span class="s">u&#39;yourbar&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;eggs&#39;</span><span class="p">][</span><span class="s">&#39;spam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;bla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;ble&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go">Here, the field `_version` is automatically added :</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_version&#39;</span><span class="p">]</span>
<span class="go">1</span>

<span class="go">Let&#39;s modify our doc :</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;eggs&#39;</span><span class="p">][</span><span class="s">&#39;spam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;bla&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s">u&#39;bli&#39;</span>

<span class="go">But now, someone is getting our doc and update it before we could save it:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">new_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">MyDoc</span><span class="o">.</span><span class="n">get_from_id</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_doc</span><span class="p">[</span><span class="s">&#39;bla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;blo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go">The doc `_version` is incremented :</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">new_doc</span><span class="p">[</span><span class="s">&#39;_version&#39;</span><span class="p">]</span>
<span class="go">2</span>

<span class="go">So, if we try to save our doc, this would raise a ConflictError as the</span>
<span class="go">data has changed. What we have to do is reload the document and try to</span>
<span class="go">save it again :</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">... </span><span class="k">except</span> <span class="n">ConflictError</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">doc</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
<span class="gp">... </span>   <span class="n">doc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;eggs&#39;</span><span class="p">][</span><span class="s">&#39;spam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>   <span class="n">doc</span><span class="p">[</span><span class="s">&#39;bla&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s">u&#39;bli&#39;</span>
<span class="gp">... </span>   <span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go">our doc version is now 3:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_version&#39;</span><span class="p">]</span>
<span class="go">3</span>

<span class="go">If we get a fresh instance of your doc, we can check that all is correct :</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">new_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">MyDoc</span><span class="o">.</span><span class="n">get_from_id</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_doc</span>
<span class="go">{&#39;foo&#39;: {&#39;eggs&#39;: {&#39;spam&#39;: 2}, &#39;bar&#39;: [u&#39;mybar&#39;, u&#39;yourbar&#39;]}, &#39;bla&#39;: u&#39;bli&#39;, &#39;_version&#39;: 3, &#39;_id&#39;: 3}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bulk-update">
<h3>Bulk update<a class="headerlink" href="#bulk-update" title="Permalink to this headline">¶</a></h3>
<p>Bulk update is not yet supported (but will be soon). For now, as Mongokit expose all the pymongo API, you can use the pymongo&#8217;s update on collection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">tutorial</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;my first blog post&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;$set&#39;</span><span class="p">:{</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="s">u&#39;my very first blog post&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>For more information, please look at the <a class="reference external" href="http://api.mongodb.org/python/">pymongo documentation</a>.</p>
</div>
<div class="section" id="reload">
<h3>reload()<a class="headerlink" href="#reload" title="Permalink to this headline">¶</a></h3>
<p>If a document was update in another thread, it would be interresting to refresh the document to
match changes from the database. To do that, use the <cite>reload()</cite> method.</p>
<p>Two thing you should know before using this method :</p>
<blockquote>
<ul class="simple">
<li>If no _id is set in the document, a KeyError is raised.</li>
<li>If a document is not saved into the database, the OperationFailure exception is raised.</li>
<li>using <cite>reload()</cite> will erase all unsaved values !</li>
</ul>
</blockquote>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&#39;foo&#39;</span><span class="p">:{</span>
<span class="gp">... </span>           <span class="s">&#39;eggs&#39;</span><span class="p">:{</span><span class="s">&#39;spam&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>       <span class="p">},</span>
<span class="gp">... </span>       <span class="s">&#39;bla&#39;</span><span class="p">:</span><span class="nb">unicode</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="go"># calling reload() here will raise a KeyError</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">][</span><span class="s">&#39;eggs&#39;</span><span class="p">][</span><span class="s">&#39;spam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;bla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;ble&#39;</span>
<span class="go"># calling reload() here will raise an OperationFailure</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;bla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;bli&#39;</span> <span class="c"># we don&#39;t save this change this will be erased</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;_id&#39;</span><span class="p">:</span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]},</span> <span class="p">{</span><span class="s">&#39;$set&#39;</span><span class="p">:{</span><span class="s">&#39;foo.eggs.spam&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span>
<span class="go">{&#39;_id&#39;: 3, &#39;foo&#39;: {u&#39;eggs&#39;: {u&#39;spam&#39;: 2}}, &#39;bla&#39;: u&#39;ble&#39;}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="changing-collection-dynamically">
<h2>Changing collection dynamically<a class="headerlink" href="#changing-collection-dynamically" title="Permalink to this headline">¶</a></h2>
<p>But you might need to specify a different db or collection dynamically. For instance,
say you want to store a User by database.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;login&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span> <span class="s">&#39;screen_name&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">User</span><span class="p">])</span>
</pre></div>
</div>
<p>Like Pymongo, Mongokit allow you to change those parameters on the fly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user_name</span> <span class="o">=</span> <span class="s">&#39;namlook&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user_col</span> <span class="o">=</span> <span class="n">con</span><span class="p">[</span><span class="n">user_name</span><span class="p">]</span><span class="o">.</span><span class="n">profile</span>
</pre></div>
</div>
<p>Now, we can query the database by passing our new collection :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">profiles</span> <span class="o">=</span> <span class="n">user_col</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">user_col</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="p">[</span><span class="s">&#39;login&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;namlook&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Namlook&#39;</span>
</pre></div>
</div>
<p>calling <cite>user.save()</cite> will save the objet into the database &#8216;namlook&#8217; in the collection &#8216;profile&#8217;</p>
</div>
<div class="section" id="dot-notation">
<h2>Dot notation<a class="headerlink" href="#dot-notation" title="Permalink to this headline">¶</a></h2>
<p>If you want to use the dot notation (ala json), you must set the
<cite>use_dot_notation</cite> attribute to True:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">TestDotNotation</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;foo&quot;</span><span class="p">:{</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span>    <span class="n">use_dot_notation</span><span class="o">=</span><span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">TestDotNotation</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">TestDotNotation</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s">u&quot;bla&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span>
<span class="go">{&#39;foo&#39;: {&#39;bar&#39;: u&#39;bla&#39;}}</span>
</pre></div>
</div>
<p>Note that if a attribute is not in structure, the value will be added as attribute :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">arf</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># arf is not in structure</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span>
<span class="go">{&#39;foo&#39;: {&#39;bar&#39;: u&#39;bla&#39;}}</span>
</pre></div>
</div>
<p>If you want to be warned when a value is set as attribute, you can set the <cite>dot_notation_warning</cite> attribute as True.</p>
</div>
<div class="section" id="embedding-documents-as-values">
<h2>Embedding Documents as values<a class="headerlink" href="#embedding-documents-as-values" title="Permalink to this headline">¶</a></h2>
<p>MongoKit has optional support for MongoDB&#8217;s autoreferencing/dbref
features. Autoreferencing allows you to embed MongoKit objects/instances
inside another MongoKit object.  With autoreferencing enabled, MongoKit and
the pymongo driver will translate the embedded MongoKit object
values into internal MongoDB DBRefs.  The (de)serialization is
handled automatically by the pymongo driver.</p>
<p>Autoreferences allow you to pass other Documents as values.
<a class="reference external" href="http://api.mongodb.org/python/">pymongo</a>.  (with help from MongoKit) automatically
translates these object values into DBRefs before persisting to
Mongo.  When fetching, it translates them back, so that you have
the data values for your referenced object. See the <a class="reference external" href="http://github.com/mongodb/mongo-python-driver/blob/cd47b2475c5fe567e98696e6bc5af3c402891d12/examples/auto_reference.py">autoref_sample</a>. for
further details/internals  on this driver-level functionality. As for
enabling it in your own MongoKit code, simply define the following class
attribute upon your Document subclass:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">use_autorefs</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>With autoref enabled, MongoKit&#8217;s connection management will attach the
appropriate BSON manipulators to your document&#8217;s connection handles.  We
require you to explicitly enable autoref for two reasons:</p>
<blockquote>
<ul class="simple">
<li>Using autoref and it&#8217;s BSON manipulators (As well as DBRefs) can carry a performance penalty.  We opt for performance and simplicity first, so you must explicitly enable autoreferencing.</li>
<li>You may not wish to use auto-referencing in some cases where you&#8217;re using DBRefs.</li>
</ul>
</blockquote>
<p>Once you have autoref enabled, MongoKit will allow you to define
any valid subclass of Document as part of your document
structure.  <strong>If your class does not define `use_autorefs` as
True, MongoKit&#8217;s structure validation code will REJECT your
structure.</strong></p>
<div class="section" id="a-detailed-example">
<h3>A detailed example<a class="headerlink" href="#a-detailed-example" title="Permalink to this headline">¶</a></h3>
<p>First let&#8217;s create a simple doc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">DocA</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;a&quot;</span><span class="p">:{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>       <span class="s">&quot;abis&quot;</span><span class="p">:{</span><span class="s">&#39;bar&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">},</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a.foo&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="gp">... </span>   <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;abis.bar&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">DocA</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doca</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">DocA</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doca</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;doca&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doca</span><span class="p">[</span><span class="s">&#39;abis&#39;</span><span class="p">][</span><span class="s">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doca</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, let&#8217;s create a DocB which have a reference to DocA:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">DocB</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;b&quot;</span><span class="p">:{</span><span class="s">&quot;doc_a&quot;</span><span class="p">:</span><span class="n">DocA</span><span class="p">},</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">use_autorefs</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Note that to be able to specify a Document into the structure, we must
set <cite>use_autorefs</cite> as <cite>True</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">DocB</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">DocB</span><span class="p">()</span>
</pre></div>
</div>
<p>The default value for an embeded doc is None:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span>
<span class="go">{&#39;b&#39;: {&#39;doc_a&#39;: None}}</span>
</pre></div>
</div>
<p>The validation act as expected:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">][</span><span class="s">&#39;doc_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">SchemaTypeError</span>: <span class="n-Identifier">b.doc_a must be an instance of DocA not int</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;docb&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">][</span><span class="s">&#39;doc_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doca</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span>
<span class="go">{&#39;b&#39;: {&#39;doc_a&#39;: {&#39;a&#39;: {&#39;foo&#39;: 2}, &#39;abis&#39;: {&#39;bar&#39;: 3}, &#39;_id&#39;: &#39;doca&#39;}}, &#39;_id&#39;: &#39;docb&#39;}</span>
</pre></div>
</div>
<p>Note that the reference can be cross collection but also cross database. So, it doesn&#8217;t matter
where you save the DocA object as long as it can be fetch with the same connection.</p>
<p>Now the interresting part. If we change a field in an embeded doc, the change will be done
for all DocA which have the same &#8216;_id&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">][</span><span class="s">&#39;doc_a&#39;</span><span class="p">][</span><span class="s">&#39;a&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doca</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">][</span><span class="s">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">4</span>
</pre></div>
</div>
<p>Required fields are also supported in embeded documents.i
Remember DocA have the &#8216;abis.bar&#8217; field required. If we set it to None
via the docb document, the RequireFieldError is raised:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">][</span><span class="s">&#39;doc_a&#39;</span><span class="p">][</span><span class="s">&#39;abis&#39;</span><span class="p">][</span><span class="s">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docb</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">RequireFieldError</span>: <span class="n-Identifier">abis.bar is required</span>
</pre></div>
</div>
<div class="section" id="about-cross-database-references">
<h4>About cross-database references<a class="headerlink" href="#about-cross-database-references" title="Permalink to this headline">¶</a></h4>
<p>pymongo&#8217;s DBRef doesn&#8217;t take a database by default so Mongokit needs this
information to fetch the correct Document.</p>
<p>An example is better than thousand words. Let&#8217;s create an <tt class="docutils literal"><span class="pre">EmbedDoc</span></tt> and a <tt class="docutils literal"><span class="pre">Doc</span></tt> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">EmbedDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
</pre></div>
</div>
<p>...   structure = {
...       &#8220;foo&#8221;: unicode,
...   }</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Doc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">use_dot_notation</span><span class="o">=</span><span class="bp">True</span>
<span class="gp">... </span>  <span class="n">use_autorefs</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">... </span>  <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>      <span class="s">&quot;embed&quot;</span><span class="p">:</span> <span class="n">EmbedDoc</span><span class="p">,</span>
<span class="gp">... </span>  <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">EmbedDoc</span><span class="p">,</span> <span class="n">Doc</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">EmbedDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s insert a raw document with a DBRef but we do not specify the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">raw_doc</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;embed&#39;</span><span class="p">:</span><span class="n">DBRef</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s">&#39;tutorial&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">embed</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">])}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc_id</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">raw_doc</span><span class="p">)</span>
</pre></div>
</div>
<p>Now what append when we want to load the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">Doc</span><span class="o">.</span><span class="n">get_from_id</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">RuntimeError</span>: <span class="n-Identifier">It appears that you try to use autorefs. I found a DBRef without database specified.</span>
<span class="go"> If you do want to use the current database, you have to add the attribute `force_autorefs_current_db` as True. Please see the doc for more details.</span>
<span class="go"> The DBRef without database is : DBRef(u&#39;tutorial&#39;, ObjectId(&#39;4b6a949890bce72958000002&#39;))</span>
</pre></div>
</div>
<p>This mean that you may load data which could have been generated by map/reduce or raw data (like fixtures for instance)
and the database information is not set into the DBRef. The error message tells you that you can add turn the
<cite>force_autorefs_current_db</cite> as True to allow mongokit to use the current collection by default (here &#8216;test&#8217;):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tutorial</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>u&#8217;test&#8217;</p>
<p>NOTE: You have to be very carefull when you enable this option to be sure that you are using the correct database.
If you expect some strange behavior (like not document found), you may look at this first.</p>
</div>
<div class="section" id="reference-and-dereference">
<h4>Reference and dereference<a class="headerlink" href="#reference-and-dereference" title="Permalink to this headline">¶</a></h4>
<div class="topic">
<p class="topic-title first">new in development version</p>
<p>You can get the dbref of a document with the <cite>get_dbref()</cite> method. The
<cite>dereference()</cite> allow to get a Document from a dbref. You can pass a Document
to tell mongokit to what model it should dereferenced:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dbref</span> <span class="o">=</span> <span class="n">mydoc</span><span class="o">.</span><span class="n">get_dbref</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">raw_doc</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">mydb</span><span class="o">.</span><span class="n">dereference</span><span class="p">(</span><span class="n">dbref</span><span class="p">)</span> <span class="c"># the result is a regular dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">mydb</span><span class="o">.</span><span class="n">dereference</span><span class="p">(</span><span class="n">dbref</span><span class="p">,</span> <span class="n">MyDoc</span><span class="p">)</span> <span class="c"># the result is a MyDoc instance</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="indexes">
<h2>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, it&#8217;s desirable to have indexes on your dataset - especially unique ones.
In order to do that, you must fill the <cite>indexes</cite> attribute. The <cite>indexes</cite> attribute
is a liste of dictionnary with the following structure:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">&#8220;fields&#8221;:</th><td class="field-body"># take a list of fields or a field name (required)</td>
</tr>
<tr class="field"><th class="field-name">&#8220;unique&#8221;:</th><td class="field-body">should this index guarantee uniqueness? (optional, False by default)</td>
</tr>
<tr class="field"><th class="field-name">&#8220;ttl&#8221;:</th><td class="field-body">(optional, 300 by default) time window (in seconds) during which this index will be recognized by subsequent calls to <cite>ensure_index</cite> - see pymongo documentation for <cite>ensure_index</cite> for details.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;standard&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;other&#39;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&#39;deep&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s">&#39;notindexed&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;fields&#39;</span><span class="p">:[</span><span class="s">&#39;standard&#39;</span><span class="p">,</span> <span class="s">&#39;other.deep&#39;</span><span class="p">],</span>
<span class="gp">... </span>            <span class="s">&#39;unique&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">]</span>
</pre></div>
</div>
<p>or if you have more than one index:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&#39;test&#39;</span>
<span class="gp">... </span>    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&#39;mongokit&#39;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;standard&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;other&#39;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&#39;deep&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s">&#39;alsoindexed&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;fields&#39;</span><span class="p">:</span><span class="s">&#39;standard&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&#39;unique&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;alsoindexed&#39;</span><span class="p">,</span> <span class="s">&#39;other.deep&#39;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">]</span>
</pre></div>
</div>
<p>By default, the index direction is set to 1. You can change the direction by
passing a list of tuple.  Direction must be one of <cite>INDEX_ASCENDING</cite> (or 1) or
<cite>INDEX_DESCENDING</cite> (or -1):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;standard&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;other&#39;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&#39;deep&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s">&#39;notindexed&#39;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&#39;fields&#39;</span><span class="p">:[(</span><span class="s">&#39;standard&#39;</span><span class="p">,</span><span class="n">INDEX_ASCENDING</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;other.deep&#39;</span><span class="p">,</span><span class="n">INDEX_DESCENDING</span><span class="p">)],</span>
<span class="gp">... </span>            <span class="s">&#39;unique&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">]</span>
</pre></div>
</div>
<p>To prevent to add an index on the wrong field (mispelled for instance),
Mongokit will check by default the <cite>indexes</cite> descriptor. There&#8217;s some case you
may wan&#8217;t to disable this. To do so, add <tt class="docutils literal"><span class="pre">&quot;check&quot;:True</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="c"># I know this field is not in the document structure, don&#39;t check it</span>
        <span class="s">&#39;fields&#39;</span><span class="p">:[</span><span class="s">&#39;foo&#39;</span><span class="p">],</span> <span class="s">&#39;checked&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="json-support">
<h2>JSON support<a class="headerlink" href="#json-support" title="Permalink to this headline">¶</a></h2>
<p>While building web application, you might want to create an rest api with json
support. Then, you may need to convert all your Document into a json format
in order to pass it via the rest api. Unfortunately (or fortunately), MongoDB
support field format which is not supported by json. This is the case for <cite>datetime</cite>
but also for all your <cite>CustomTypes</cite> you may have built and your embeded objects.</p>
<p>Document support the json import/export. Note that you&#8217;ll need to install <cite>anyjson</cite>
to enable this feature. (<cite>sudo easy_install anyjson</cite>)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name"><cite>to_json</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p><cite>to_json</cite> is a simply method which export you document into a json document:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s">&quot;bla&quot;</span><span class="p">:{</span>
<span class="gp">... </span>                <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>                <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>            <span class="p">},</span>
<span class="gp">... </span>            <span class="s">&quot;spam&quot;</span><span class="p">:[],</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">MyDoc</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;mydoc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&quot;bla&quot;</span><span class="p">][</span><span class="s">&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;bar&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&quot;bla&quot;</span><span class="p">][</span><span class="s">&quot;bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;spam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span> <span class="o">=</span> <span class="n">mydoc</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span>
<span class="go">u&#39;{&quot;_id&quot;: &quot;mydoc&quot;, &quot;bla&quot;: {&quot;foo&quot;: &quot;bar&quot;, &quot;bar&quot;: 42}, &quot;spam&quot;: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]}&#39;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name"><cite>from_json</cite>:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>To load a json string into a Document, use the <cite>from_json</cite> class method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;bla&quot;</span><span class="p">:{</span>
<span class="gp">... </span>            <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">unicode</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s">&quot;bar&quot;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s">&quot;spam&quot;</span><span class="p">:[],</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span> <span class="o">=</span> <span class="s">&#39;{&quot;_id&quot;: &quot;mydoc&quot;, &quot;bla&quot;: {&quot;foo&quot;: &quot;bar&quot;, &quot;bar&quot;: 42}, &quot;spam&quot;: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span>
<span class="go">{&#39;_id&#39;: &#39;mydoc&#39;, &#39;bla&#39;: {&#39;foo&#39;: &#39;bar&#39;, &#39;bar&#39;: 42}, &#39;spam&#39;: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]}</span>
</pre></div>
</div>
<p>Note that <cite>from_json</cite> will take care of all your embeded Docs if you used the <cite>to_json()</cite> method to
generated the json. Indeed, some extra value has to be set : the datatabase and the collection where
the embed document lives. This is added by the <cite>to_json()</cite> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">EmbedDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">db_name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span>
<span class="gp">... </span>    <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&quot;mongokit&quot;</span>
<span class="gp">... </span>    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s">&quot;foo&quot;</span><span class="p">:</span><span class="nb">unicode</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyDoc</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">db_name</span> <span class="o">=</span> <span class="s">&quot;test&quot;</span>
<span class="gp">... </span>   <span class="n">collection_name</span> <span class="o">=</span> <span class="s">&quot;mongokit&quot;</span>
<span class="gp">... </span>   <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>       <span class="s">&quot;doc&quot;</span><span class="p">:{</span>
<span class="gp">... </span>           <span class="s">&quot;embed&quot;</span><span class="p">:</span><span class="n">EmbedDoc</span><span class="p">,</span>
<span class="gp">... </span>       <span class="p">},</span>
<span class="gp">... </span>   <span class="p">}</span>
<span class="gp">... </span>   <span class="n">use_autorefs</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">EmbedDoc</span><span class="p">,</span> <span class="n">MyDoc</span><span class="p">])</span>
</pre></div>
</div>
<p>Let&#8217;s create an embed doc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">EmbedDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;embed&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;bar&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>and embed this doc to another doc</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;mydoc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;doc&#39;</span><span class="p">][</span><span class="s">&#39;embed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">embed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s see how look the generated json:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">json</span> <span class="o">=</span> <span class="n">mydoc</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span>
<span class="go">u&#39;{&quot;doc&quot;: {&quot;embed&quot;: {&quot;_collection&quot;: &quot;tutorial&quot;, &quot;_database&quot;: &quot;test&quot;, &quot;_id&quot;: &quot;embed&quot;, &quot;foo&quot;: &quot;bar&quot;}}, &quot;_id&quot;: &quot;mydoc&quot;}&#39;</span>
</pre></div>
</div>
<p>As you can see, two new fields have been added : <cite>_collection</cite> and <cite>_database</cite>
which represent respectively the collection and the database where the embed
doc has been saved. Thoses informations are needed to generate the embed
document. There are removed when calling the <cite>from_json()</cite> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span>
<span class="go">{u&#39;doc&#39;: {u&#39;embed&#39;: {u&#39;_id&#39;: u&#39;embed&#39;, u&#39;foo&#39;: u&#39;bar&#39;}}, u&#39;_id&#39;: u&#39;mydoc&#39;}</span>
</pre></div>
</div>
<p>An the embed document is an instance of EmbedDoc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;doc&#39;</span><span class="p">][</span><span class="s">&#39;embed&#39;</span><span class="p">],</span> <span class="n">EmbedDoc</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="objectid-support">
<h3>ObjectId support<a class="headerlink" href="#objectid-support" title="Permalink to this headline">¶</a></h3>
<p><cite>from_json()</cite> can detect if the <cite>_id</cite> is an <tt class="docutils literal"><span class="pre">ObjectId</span></tt> instance or a simple string. When you serialize an object
with <tt class="docutils literal"><span class="pre">ObjectId</span></tt> instance to json, the generated json object look like this:</p>
<blockquote>
&#8216;{&#8220;_id&#8221;: {&#8220;$oid&#8221;: &#8220;...&#8221;}, ...}&#8217;</blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">EmbedDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;bar&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="go">u&#39;{&quot;foo&quot;: &quot;bar&quot;, &quot;_id&quot;: {&quot;$oid&quot;: &quot;4b5ec47390bce737e5000002&quot;}}&#39;</span>
</pre></div>
</div>
<p>the &#8220;$oid&#8221; field is added to tell <cite>from_json()</cite> that &#8216;_id&#8217; is an <tt class="docutils literal"><span class="pre">ObjectId</span></tt> instance.
The same append with embed doc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span> <span class="o">=</span> <span class="n">tutorial</span><span class="o">.</span><span class="n">MyDoc</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="p">[</span><span class="s">&#39;doc&#39;</span><span class="p">][</span><span class="s">&#39;embed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">embed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydoc</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="go">{&#39;doc&#39;: {&#39;embed&#39;: {u&#39;_id&#39;: ObjectId(&#39;4b5ec45090bce737cb000002&#39;), u&#39;foo&#39;: u&#39;bar&#39;}}, &#39;_id&#39;: ObjectId(&#39;4b5ec45090bce737cb000003&#39;)}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="inheritance.html" title="Polymorphism with MongoKit"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="MongoKit"
             >previous</a> |</li>
        <li><a href="index.html">MongoKit v0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009-2010, Namlook.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>